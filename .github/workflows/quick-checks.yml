name: Quick Checks

on:
  push:
    branches: [copilot/**]
  pull_request:

jobs:
  quick-lint:
    name: Quick Lint & Syntax Check
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.1'

      - name: PHP Syntax Check
        run: |
          echo "üîç Checking PHP syntax..."
          ERROR_COUNT=0
          while IFS= read -r -d '' file; do
            if ! php -l "$file" > /dev/null 2>&1; then
              echo "‚ùå Syntax error in: $file"
              php -l "$file"
              ERROR_COUNT=$((ERROR_COUNT + 1))
            else
              echo "‚úÖ $file"
            fi
          done < <(find . -name "*.php" -type f -print0)

          if [ $ERROR_COUNT -eq 0 ]; then
            echo "‚úÖ All PHP files passed syntax check"
          else
            echo "‚ùå Found $ERROR_COUNT file(s) with syntax errors"
            exit 1
          fi

      - name: Check YAML syntax
        run: |
          echo "üîç Checking YAML syntax..."
          pip install yamllint
          yamllint -d relaxed $(find . -name "*.yml" -type f) || echo "‚ö†Ô∏è YAML warnings found"

      - name: Check for common issues
        run: |
          echo "üîç Checking for common issues..."

          # Check for TODO/FIXME comments
          echo "Checking for TODO/FIXME..."
          grep -r "TODO\|FIXME" --include="*.php" src/ || echo "‚úÖ No TODO/FIXME found"

          # Check for var_dump/print_r
          echo "Checking for debug statements..."
          if grep -r "var_dump\|print_r\|dd(" --include="*.php" src/; then
            echo "‚ö†Ô∏è Debug statements found - please remove before merge"
          else
            echo "‚úÖ No debug statements found"
          fi

          # Check file permissions
          echo "Checking file permissions..."
          find . -type f -name "*.php" -executable -ls || echo "‚úÖ No executable PHP files"

      - name: Summary
        if: always()
        run: |
          cat << 'EOF'

          ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

          ‚ú® Quick Checks Complete

          For full testing including Drupal installation and
          visual verification, see the "Drupal Module Tests" workflow.

          ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
          EOF
